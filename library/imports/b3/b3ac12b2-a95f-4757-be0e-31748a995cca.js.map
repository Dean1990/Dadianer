{"version":3,"sources":["../../../../assets/script/assets/script/PaiAn.js"],"names":["com","require","cc","Class","extends","Component","properties","player","default","type","Sprite","xuanZhuanBtn","Button","onLoad","checkEnableXuanZhan","enabled","node","destroy","xuanPai","Array","setCascadeOpacityEnabled","addChild","setPosition","p","width","drawPai","xuanZhan","isEnableXuanZhan","actionLabel","string","lang","declareWar","follow","isXuanZhan","normalColor","Color","GREY","chuPai","self","checkChuPai","isValid","m","shouPai","length","off","Node","EventType","TOUCH_START","touchPai","indexArr","windowSize","winSize","i","j","_name","push","splice","sort","lastPai","sprite","removeFromParent","reverse","n","nextPlayer","pop","runAction","moveBy","buChuPai","sortPai","num","pai","parent","on","event","target","index"],"mappings":"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","file":"PaiAn.js","sourceRoot":"../../../../assets/script","sourcesContent":["var com = require('Common');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        player:{\n\n            default:null,\n            type:cc.Sprite,\n\n        },\n\n        xuanZhuanBtn:{\n            default:null,\n            type:cc.Button,\n        },\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n        //cc.log(this.xuanZhuanBtn);\n\n        if(com.checkEnableXuanZhan(0)!=0){\n\n            this.xuanZhuanBtn.enabled= true;\n\n        }else {\n\n            //this.xuanZhuanBtn.node.removeFromParent();\n\n            this.xuanZhuanBtn.node.destroy();\n\n        }\n\n        this.player.xuanPai = new Array();\n\n        \n        //玩家头像\n        var node = this.player.node;\n\n        node.setCascadeOpacityEnabled(false);\n\n        // cc.director.getScene().addChild(node);\n\n        this.node.addChild(node);\n\n        node.setPosition(cc.p(-this.node.width/2-(node.width/3*2),0));\n\n        //展示手牌\n        this.drawPai();\n\n    },\n\n    /**\n     * 点击宣战\n     */\n    xuanZhan:function(){\n\n        var isEnableXuanZhan = com.checkEnableXuanZhan();\n\n        if(isEnableXuanZhan==1){\n\n            this.player.actionLabel.string = com.lang.declareWar;\n\n        }else if(isEnableXuanZhan==2){\n\n            this.player.actionLabel.string = com.lang.follow;\n\n        }\n\n        //宣战 修改全局变量\n        com.isXuanZhan = true;\n\n        this.xuanZhuanBtn.enabled=false;\n\n        this.xuanZhuanBtn.normalColor = cc.Color.GREY;\n\n        this.player.isXuanZhan = true;\n\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n\n    /**\n     * 出牌\n     */\n    chuPai:function(){\n\n        var self = this;\n\n        //出牌合法性\n        if(com.checkChuPai(self.player.xuanPai,0)){\n\n            if(this.xuanZhuanBtn!=null&&this.xuanZhuanBtn.isValid){\n\n                this.xuanZhuanBtn.enabled =false;\n\n                this.xuanZhuanBtn.normalColor = cc.Color.GREY;\n\n            }\n            \n\n            //移除TOUCH监听\n            for(var m = 0;m<self.player.shouPai.length;m++){\n\n                self.player.shouPai[m].off(cc.Node.EventType.TOUCH_START,self.touchPai,this);\n\n            }\n\n            //合法\n            var indexArr = new Array();\n\n            var windowSize = cc.winSize;\n\n            //得到要出的牌在手牌中的位置\n            for(var i = 0;i<self.player.xuanPai.length;i++){\n\n                for(var j=0;j<self.player.shouPai.length;j++){\n\n                    if(self.player.shouPai[j]._name==self.player.xuanPai[i]._name){\n\n                        //cc.log(self.player.shouPai[j]._name);\n\n                        indexArr.push(j);\n\n                    }\n                }\n            }\n\n            self.player.xuanPai.splice(0,self.player.xuanPai.length);\n\n            indexArr.sort();\n\n            //清空牌桌\n            //com.clearPaiZhuo();\n\n            var lastPai = new Array();\n\n            //出牌动作\n            for(var i = 0;i<indexArr.length;i++){\n\n                var sprite = self.player.shouPai[indexArr[i]];\n\n                //记录出牌\n                lastPai.push(sprite);\n\n                sprite.removeFromParent();\n\n                // var p = sprite.convertToWorldSpace(cc.p(0,0));\n\n                // var nodeP = self.node.convertToWorldSpace(cc.p(self.node.getContentSize().width/2,self.node.getContentSize().height/2));\n\n                // var x = windowSize.width/2-nodeP.x+30*i;\n\n                // var y = windowSize.height/2-p.y;\n\n                // sprite.runAction(cc.moveTo(0.5,cc.p(x,y)));\n\n            }\n            \n\n            indexArr.reverse();\n            \n            //从手牌中删除\n            for(var n = 0;n<indexArr.length;n++){\n\n                self.player.shouPai.splice(indexArr[n],1);\n\n            }\n\n            //刷新手牌展示\n            self.drawPai();\n\n            com.nextPlayer(lastPai);\n\n        }else {\n            //不合法\n            var length = self.player.xuanPai.length;\n\n            for(var i = 0;i<length;i++){\n\n                self.player.xuanPai.pop().runAction(cc.moveBy(0.1,0,-30));\n\n            }\n        \n        }\n\n    },\n\n    \n    buChuPai:function(){\n\n        if(this.xuanZhuanBtn!=null&&this.xuanZhuanBtn.isValid){\n            this.xuanZhuanBtn.enabled=false;\n\n            this.xuanZhuanBtn.normalColor = cc.Color.GREY;\n        }\n\n        com.nextPlayer();\n\n        \n\n    },\n\n    /**\n     * 展示手牌\n     */\n    drawPai:function(){\n\n        var self = this;\n\n        com.sortPai(self.player.shouPai);\n\n        var num = self.player.shouPai.length;\n\n        //var size = self.node.getContentSize();\n\n        for(var i = 0;i<num;i++){\n\n            var pai = self.player.shouPai[i];\n            // cc.log(\"pai i:\"+i);\n            // cc.log(pai);\n            // cc.log(\"self.node:\");\n            // cc.log(self.node);\n\n            if(pai.parent!=self.node){\n                \n                self.node.addChild(pai);\n\n            }\n\n            pai.setCascadeOpacityEnabled(false);\n\n            var p = cc.p(-(pai.width+(num-1)*30)/2+pai.width/2+i*30,0);\n            \n            // pai.setScale(0.5);\n            pai.setPosition(p);\n            pai.on(cc.Node.EventType.TOUCH_START,self.touchPai,this);\n\n        }\n        \n\n    },\n\n    /**\n     * TOUCH监听回调\n     */\n    touchPai:function(event){\n\n        var self = this;\n\n        var node = event.target;\n        var index = -1;\n\n        for(var j = 0;j<self.player.xuanPai.length;j++){\n\n            if(node._name==self.player.xuanPai[j]._name){\n\n                index = j;\n\n                break;\n\n            }\n\n        }\n\n        if(index==-1){\n\n            self.player.xuanPai.push(node);\n\n            node.runAction(cc.moveBy(0.1,0,30));\n\n        }else {\n\n            self.player.xuanPai.splice(index,1);\n\n            node.runAction(cc.moveBy(0.1,0,-30));\n\n        }\n\n    },\n});\n"]}