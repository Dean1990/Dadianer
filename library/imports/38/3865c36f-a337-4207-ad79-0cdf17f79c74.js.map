{"version":3,"sources":["../../../../assets/script/assets/script/AI.js"],"names":["com","require","module","exports","chuPai","player","getWindPlayerNum","isPlayerParty","_currentPlayer","nextPlayer","sortPai","shouPai","isEnableXuanZhan","checkEnableXuanZhan","isXuanZhan","actionLabel","string","lang","declareWar","follow","_lastPai","length","firstChuPai","pais","getEnableChuPai","weightArr","analyze","splice","lastWeight","convertValueMore","i","weight","lastPlayerNum","sortWeightArr","j","tempArr","trim","trimWeightArr","Array","indexArr","indexOf","push","f","_name","substring","l","parseInt","convertClownValue","f2","slice","convertValue","isCompose","l2"],"mappings":"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","file":"AI.js","sourceRoot":"../../../../assets/script","sourcesContent":["var com = require('Common');\nmodule.exports = {\n\n    chuPai: function (player){\n\n        //有人要风\n        if(com.getWindPlayerNum!=-1){\n\n            if(com.isPlayerParty(com._currentPlayer,com.getWindPlayerNum)){\n                //队友  不出\n                com.nextPlayer();\n\n                return;\n                \n            }\n\n        }\n\n        com.sortPai(player.shouPai)\n\n        var isEnableXuanZhan = com.checkEnableXuanZhan();\n\n        if(isEnableXuanZhan!=0){\n            //可以宣战\n            //设置宣战\n            player.isXuanZhan = true;\n\n            //宣战 修改全局变量\n            com.isXuanZhan = true;\n\n            if(isEnableXuanZhan==1){\n\n                player.actionLabel.string = com.lang.declareWar;\n\n            }else if(isEnableXuanZhan==2){\n\n                player.actionLabel.string = com.lang.follow;\n\n            }\n            \n        }\n\n        if((com.getWindPlayerNum==com._currentPlayer) || com._lastPai==null||com._lastPai.length==0){\n\n            this.firstChuPai(player);\n\n        }else {\n\n            var pais = this.getEnableChuPai(player);\n\n            com.nextPlayer(pais);\n\n            \n        }\n\n    },\n\n    /**\n     * 第一个出牌\n     */\n    firstChuPai:function(player){\n\n        var weightArr = this.analyze(player.shouPai);\n\n        //出一个最小权值的组合\n        if(weightArr.length>0){\n\n            var pais = player.shouPai.splice(weightArr[0][1],weightArr[0][2]);\n\n            com.nextPlayer(pais);\n\n        }\n\n    },\n\n    /**\n     * 计算出可以出的牌\n     */\n    getEnableChuPai:function(player){\n\n            var weightArr = this.analyze(player.shouPai);\n\n            var lastWeight = com.convertValueMore(com._lastPai);\n\n            //要出的牌\n            var pais = null;\n\n            for(var i = 0;i<weightArr.length;i++){\n\n                var weight = weightArr[i][0];\n\n                if(weight>lastWeight && (((com._lastPai.length==1 && (weight<=180 || weight>1600))||com._lastPai.length>1))){\n\n                    //上一张牌是否是队友出的\n                    if(com.isPlayerParty(com._currentPlayer,com.lastPlayerNum) && ((com._lastPai.length==1 && weight>140) || (com._lastPai.length>1 && weight>1400))){\n                        //不怼队友\n                        //大于A或者大于对A 不出\n                    }else {\n\n                        //出牌\n                        pais = player.shouPai.splice(weightArr[i][1],weightArr[i][2]);\n\n                    }\n\n                    break;\n\n                }\n\n            }\n\n            return pais;\n\n    },\n\n    /**\n     * 出牌动作\n     */\n    // chuPaiAction:function(pais){\n\n    //     var size = cc.winSize;\n\n    //     // //清空lastPai\n    //     // if(com._lastPai!=null){\n    //     //     //清空上家出的牌 准备记录此次出牌\n    //     //     com._lastPai.splice(0,com._lastPai.length);\n\n    //     // }else {\n\n    //     //     com._lastPai = new Array();\n\n    //     // }\n\n    //     //展示\n    //     for(var j = 0;j<pais.length;j++){\n\n    //         var node = pais[j];\n\n    //         cc.director.getScene().addChild(node);\n\n    //         node.setPosition(cc.p(size.width/2 + j*30,size.height/2));\n\n    //         //更新到lastPai\n    //         // com._lastPai.push(pais[j]);\n\n    //     }\n\n    // },\n\n    /**\n     * 排序权值列表\n     */\n    sortWeightArr:function(weightArr){\n\n        for(var i = 0;i<weightArr.length;i++){\n\n            for(var j = i;j<weightArr.length;j++){\n\n                if(weightArr[i][0]>weightArr[j][0]){\n\n                    var tempArr = weightArr[i];\n\n                    weightArr[i] = weightArr[j];\n\n                    weightArr[j] = tempArr;\n\n                }\n\n            }\n\n        }\n\n    },\n\n    /**\n     * 剔除不合理的权值\n     */\n    trim:function(weightArr){\n\n        var trimWeightArr = new Array();\n\n        if(weightArr!=null && weightArr.length>0){\n\n            var indexArr = new Array();\n\n            for(var i = weightArr.length-1;i>=0;i--){\n\n                if(indexArr.indexOf(weightArr[i][1])==-1){\n\n                    //大于等于最小的炸 不拆开用 //对鬼也没考虑拆开\n                    if(weightArr[i][0]>1600){\n\n                        for(var j = weightArr[i][1];j<(weightArr[i][1] + weightArr[i][2]);j++){\n\n                            indexArr.push(j);\n\n                        }\n\n                    }\n\n                    trimWeightArr.push(weightArr[i]);\n                    \n                }\n\n                \n\n            }\n\n        }\n\n        this.sortWeightArr(trimWeightArr);\n\n        return trimWeightArr;\n\n    },\n\n    /**\n     * 计算可以出牌的所有权值\n     */\n    analyze:function(pais){\n\n        var weightArr = new Array();//[权值,开始下标,长度]\n\n        // var lastLength = com._lastPai.length;\n\n        if(pais!=null){\n\n            // for(var j = 0;j<pais.length;j++){\n            //     cc.log(pais[j]._name);\n            // }\n                \n\n            for(var i = 0;i<pais.length;i++){\n\n                // cc.log(\"i:\"+i);\n                // cc.log(weightArr.length);\n                // cc.log(pais[i]._name);\n\n                var f = pais[i]._name.substring(0,1);\n\n                var l = parseInt(pais[i]._name.substring(1));\n\n                if(f == \"E\"){\n                    // if(lastLength==1){\n                        //鬼 单张\n                        weightArr.push([com.convertClownValue(l),i,1]);\n                    // }\n\n                    var j = i+1;\n\n                    if(j<pais.length){\n\n                        var f2 = pais[j]._name.substring(0,1);\n                        if(f2 == \"E\"){\n                            //存储对鬼的权值\n                            weightArr.push([com.convertValueMore(pais.slice(i,j+1)),i,2]);\n\n                        }\n\n                    }\n\n                }else {\n                    // if(lastLength==1){\n                        //对单张的权值保存\n                        weightArr.push([com.convertValue(l),i,1]);\n                    // }\n\n                    var j = 0;\n\n                    var isCompose = false;\n\n                    do{\n                        j++;\n\n                        if((i+j)<pais.length){\n                        \n                            var l2 = parseInt(pais[i+j]._name.substring(1));\n\n                            isCompose = l==l2;\n\n                            // var isDifferentFive = false;\n                            // //对花5的处理\n                            // if(l==5 && j==1){\n\n                            //     var f2 = pais[i+j]._name.substring(0,1);\n\n                            //     var code = f.charCodeAt()+f2.charCodeAt();\n\n                            //     //不是对黑5红5\n                            //     if(code!=196 && code!=198){\n\n                            //         isDifferentFive = true;\n\n                            //     }\n\n                            // }\n\n                            // if(isCompose && (!(lastLength==1 && j==1) || (l==5 && !isDifferentFive))){\n                            if(isCompose){\n\n                                //对多张的权值保存\n                                weightArr.push([com.convertValueMore(pais.slice(i,i+j+1)),i,j+1]);\n                                \n                            }\n\n                        }else{\n\n                            break;\n\n                        }\n\n                    }while(isCompose);\n\n                    if(l!=5){\n                        //5特殊不能省略这个过程\n                        //去除重复权值计算\n                        i = i+j-1;\n                    }\n\n                }\n\n            }\n\n        }\n\n        this.sortWeightArr(weightArr);\n\n        return this.trim(weightArr);\n\n    },\n\n\n    \n\n};\n"]}